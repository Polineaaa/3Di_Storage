{% load static %}
<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>3D Storage</title>
<!-- ... –≤–∞—à–∏ —Å—Ç–∞—Ä—ã–µ —Ç–µ–≥–∏ ... -->
<!-- –í–ê–ñ–ù–û: –≠—Ç–æ –∫–∞—Ä—Ç–∞, —É–∫–∞–∑—ã–≤–∞—é—â–∞—è –±—Ä–∞—É–∑–µ—Ä—É, –≥–¥–µ –±—Ä–∞—Ç—å –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ -->
<script type="importmap">
{
"imports": {
"three": "https://unpkg.com/three@0.160.0/build/three.module.js",
"three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
}
}
</script>
<!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ CSS (–æ—Å—Ç–∞–≤—å—Ç–µ –∫–∞–∫ –±—ã–ª–æ) -->
<link rel="stylesheet" href="{% static 'gallery/style.css' %}">

</head>
<body>

<header>
    <h1>{{ page_title }}</h1>

    <!-- –ö–Ω–æ–ø–∫–∞ –ø–µ—Ä–µ—Ö–æ–¥–∞ –Ω–∞ –∑–∞–≥—Ä—É–∑–∫—É -->
    <a href="{% url 'upload' %}" class="btn" style="background-color: #28a745;">
        + –ó–∞–≥—Ä—É–∑–∏—Ç—å –º–æ–¥–µ–ª—å
    </a>
</header>

<main>
    <!-- –°–µ—Ç–∫–∞ –≥–∞–ª–µ—Ä–µ–∏ -->
    <div class="gallery-grid">

        {% for asset in assets %}
        <!-- –ö–∞—Ä—Ç–æ—á–∫–∞ -->
        <div class="asset-card">

            <!-- –ü—Ä–µ–≤—å—é (–∑–∞–≥–ª—É—à–∫–∞ –ø–æ–¥ 3D) -->
            <div class="card-preview"
                 id="model-container-{{ asset.id }}"
                 {% if asset.file %}
                 data-url="{{ asset.file.url }}"
                 {% endif %}
            >
                üé≤
            </div>

            <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
            <div class="card-info">
                <h3 class="card-title">{{ asset.title }}</h3>

                <div class="card-meta">
                    <span>üìÖ {{ asset.created_at|date:"d M Y" }}</span>

                    {% if asset.file %}
                    <span style="float: right;">
                        üíæ {{ asset.file.size|filesizeformat }}
                    </span>
                    {% endif %}
                </div>

                {% if asset.file %}
                    <a href="{{ asset.file.url }}" class="btn" download>
                        –°–∫–∞—á–∞—Ç—å .glb
                    </a>
                {% else %}
                    <span style="color: red;">–§–∞–π–ª –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç</span>
                {% endif %}
            </div>
        </div>
        {% empty %}
            <p>–ë–∞–∑–∞ –ø—É—Å—Ç–∞.</p>
        {% endfor %}

    </div>
</main>
<!-- type="module" –≤–∫–ª—é—á–∞–µ—Ç —Ä–µ–∂–∏–º —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∏–º–ø–æ—Ä—Ç–æ–≤ -->
<script type="module">
  console.log("module script started");

// –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –Ω–∞—à—É —Ñ—É–Ω–∫—Ü–∏—é.
// –û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ: –ø—É—Ç—å –∫ JS —á–µ—Ä–µ–∑ static
import { mountSimpleCube } from "{% static 'gallery/js/viewer.js' %}";
// –ù–∞—Ö–æ–¥–∏–º –≤—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∫–∞—Ä—Ç–æ—á–µ–∫
const containers = document.querySelectorAll('.card-preview');
if (containers.length > 0) {
// –ë–µ—Ä–µ–º —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —Ç–µ—Å—Ç–∞
const firstContainer = containers[0];
// –ü–æ–ª—É—á–∞–µ–º –µ–≥–æ ID (–º—ã –∑–∞–¥–∞–ª–∏ –µ–≥–æ –Ω–∞ –ø—Ä–æ—à–ª–æ–π –Ω–µ–¥–µ–ª–µ: model-container-{{ asset.id }})
const containerId = firstContainer.id;
// –ó–∞–ø—É—Å–∫–∞–µ–º –º–∞–≥–∏—é
mountSimpleCube(containerId);
}
</script>
</body>
</html>
