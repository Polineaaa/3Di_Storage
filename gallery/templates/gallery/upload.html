{% load static %}

<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Загрузка модели</title>

  <link rel="icon" type="image/png" href="{% static 'gallery/img/favicon.png' %}">
  <link rel="stylesheet" href="{% static 'gallery/style.css' %}">

  <script type="importmap">
  {
    "imports": {
      "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
      "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
    }
  }
  </script>
</head>

<body class="ui">

  {% if messages %}
    <div class="messages-container">
      {% for message in messages %}
        <div class="alert {{ message.tags }}">{{ message }}</div>
      {% endfor %}
    </div>
  {% endif %}

  <div class="page">

    <!-- HERO (упрощённый) -->
    <header class="hero hero-simple">
      <div class="hero-inner">
        <div class="hero-left">
          <a class="btn btn-back" href="{% url 'home' %}">
            ← Назад
          </a>
        </div>

        <div class="hero-logo">
          <img src="{% static 'gallery/img/logo.png' %}" alt="Галерея 3D ассетов">
        </div>

        <div class="hero-actions">
          <span class="hero-title-badge">Загрузка модели</span>
        </div>
      </div>
    </header>

    <main class="content">
      <section class="upload-shell">

        <div class="upload-card">
          <div class="asset-windowbar">
            <span class="dot dot-red"></span>
            <span class="dot dot-yellow"></span>
            <span class="dot dot-green"></span>
            <span class="windowbar-line"></span>
          </div>

          <div class="upload-body">

            <h1 class="upload-title">Загрузить новую 3D модель</h1>
            <p class="upload-subtitle">
              Выбери .glb, мы сделаем превью автоматически и сохраним модель.
            </p>

            <form method="post" enctype="multipart/form-data" class="upload-form">
              {% csrf_token %}

              <!-- Поля Django формы -->
              <div class="form-grid">
                {{ form.as_p }}
              </div>

              <!-- Превью -->
              <div class="upload-preview">
                <div class="upload-preview-head">
                  <span class="upload-preview-label">Авто-генерация превью</span>
                 
                </div>

                <div id="preview-container" class="preview-box">
                  <span class="preview-placeholder">Выберите файл...</span>
                </div>

                <input type="hidden" name="image_data" id="id_image_data">
              </div>

              <!-- Действия -->
              <div class="upload-actions">
                <button type="submit" id="submit-btn" class="btn btn-upload-submit" disabled>
                  Загрузить в базу
                </button>

                <a href="{% url 'home' %}" class="btn btn-ghost-link">
                  Отмена
                </a>
              </div>

              <!-- Скрипт автопревью -->
              <script type="module" src="{% static 'gallery/js/autothumb.js' %}"></script>
            </form>

          </div>
        </div>

        <!-- маленькая подсказка справа (необязательно, но выглядит “как продукт”) -->
        <aside class="upload-side">
          <div class="upload-tip">
            <div class="upload-tip-title">Подсказка</div>
            <div class="upload-tip-text">
              Если превью долго не появляется - проверь, что файл реально .glb и не битый.
              После генерации кнопка станет активной.
            </div>
          </div>
        </aside>

      </section>
    </main>

  </div>

</body>
</html>
